<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Usuarios</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Usuarios</h1>
      <nav>
        <a href="index.html">CRUD</a> | <a href="report.html">Reporte</a>
        <button id="logout">Salir</button>
      </nav>
    </header>

    <section>
      <h2>Lista de Usuarios</h2>
      <table id="usersTable">
        <thead><tr><th>ID</th><th>Usuario</th><th>Contrase√±a (texto)</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>
  </div>

  <script>
    const tbody = document.querySelector('#usersTable tbody');
    const logout = document.getElementById('logout');
    function authHeaders() {
      const t = localStorage.getItem('token');
      return t ? { Authorization: 'Bearer ' + t } : {};
    }

    logout.addEventListener('click', () => {
      localStorage.removeItem('token');
      location.href = 'login.html';
    });

    (async function loadUsers(){
      const res = await fetch('/api/auth/users', { headers: { ...authHeaders() } });
      if (!res.ok) {
        alert('No autorizado. Logueate.');
        location.href = 'login.html';
        return;
      }
      const users = await res.json();
      tbody.innerHTML = users.map(u => `<tr><td>${u.id}</td><td>${u.username}</td><td>${u.password}</td></tr>`).join('');
    })();
  </script>
</body>
</html>
